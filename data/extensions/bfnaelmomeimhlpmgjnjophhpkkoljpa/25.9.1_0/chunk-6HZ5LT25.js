import{b as qe}from"./chunk-B5RBJIEI.js";import{a as ze}from"./chunk-DIDVQIO4.js";import{b as $e}from"./chunk-HROBW3I6.js";import{a as Be}from"./chunk-RB5D6XZ6.js";import{Sb as Y,Tb as k,Vc as Me,rc as we,sd as Qe}from"./chunk-PQZYPWXP.js";import{b as Ie}from"./chunk-QDZH7H34.js";import{h as Se}from"./chunk-ETHULGZP.js";import{f as De}from"./chunk-LGUE2NXS.js";import{c as R,j as Le}from"./chunk-RNP7TDDY.js";import{dd as ke,fe as xe,gb as Z,gd as Pe,ob as Ae}from"./chunk-ERHX3GUR.js";import{a as Ue}from"./chunk-ZTEVIBRP.js";import{D as Ee,_ as Ne,a as E,c as ee,l as s,m as g,r as N}from"./chunk-X6EPTHBD.js";import{a as K,m as Te}from"./chunk-FI5JCZQR.js";import{$ as Ce,ta as Fe}from"./chunk-W476YZUB.js";import{q as J}from"./chunk-ZIPBM4OE.js";import{U as ve}from"./chunk-HTY4DAML.js";import{a as be}from"./chunk-6MAAUKN7.js";import{f as he,h as L,n as D}from"./chunk-3KENBVE7.js";L();D();var e=he(be());L();D();var a=he(be()),Ve=({width:f,trackColor:v="#181818",spinnerColor:r="#AB9FF2"})=>a.default.createElement("svg",{width:f,height:f,viewBox:"0 0 26 26"},a.default.createElement("g",null,a.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13 23.413c5.751 0 10.413-4.662 10.413-10.413S18.751 2.587 13 2.587 2.587 7.249 2.587 13 7.249 23.413 13 23.413zm0 2.315c7.03 0 12.727-5.699 12.727-12.728S20.03.273 13 .273C5.97.273.273 5.97.273 13 .273 20.03 5.97 25.728 13 25.728z",fill:v})),a.default.createElement("g",null,a.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.382 24.125a1.157 1.157 0 01.623-1.513 10.412 10.412 0 005.607-13.617 1.157 1.157 0 112.136-.89 12.726 12.726 0 01-6.853 16.643 1.157 1.157 0 01-1.513-.623z",fill:r})));Ve.defaultProps={width:44};var te=({diameter:f,color:v,trackColor:r,position:P})=>a.default.createElement(a.default.Fragment,null,a.default.createElement("style",null,`@keyframes rotate {
            100% {
              transform: rotate(360deg);
            }
          }`),a.default.createElement("div",{style:{position:P,width:`${f}px`,height:`${f}px`,animation:"rotate 0.5s linear infinite"}},a.default.createElement(Ve,{width:f,spinnerColor:v,trackColor:r})));te.defaultProps={diameter:44};var Bt=({onClose:f,onClickBuy:v})=>{let{t:r}=Te(),[P,x]=(0,e.useState)(void 0),oe=Ue(),d=Le(),{quickSelectDenominations:je,minPurchaseAmountUsd:B,maxPurchaseAmountUsd:U,purchaseType:$,fungible:Oe,ownerPublicKey:z,purchaseAmount:c,setState:l,paymentMethod:q,provider:V,checkoutQuoteType:_e,redirectURL:re}=d,p=parseFloat(c),m=$==="currency",{name:j,symbol:n,decimals:ne,caip19:C,logoURI:He}=Oe||{},h=C?.chainId,O=Pe(),{data:We=""}=xe({select:t=>t?.name}),{data:ie}=we({query:{data:C}}),i=ie?ie?.usd:void 0,{currencySymbol:Xe,currencyCode:T,toUsd:w,fromUsd:A}=Ie(),I=(0,e.useMemo)(()=>{if(P)return!1;let t=c.length>0,o=p>0,y=Number.isFinite(p);return t&&o&&y},[P,c,p]),Ge=(0,e.useMemo)(()=>{if(!i)return`??? ${n}`;if(m){let o=Me.get(h).formDisplayPrecision,y=w(p),Q=k(y,i,o),F=Qe(Q,o);return c===""?`0 ${n}`:F.length+(n?.length??0)<15?`~${F} ${n}`:`~${F.substring(0,8)}... ${n}`}let t=c===""?0:Y(p,i);return e.default.createElement(ze,{value:t,font:"caption",color:"textSecondary"})},[n,h,c,p,m,w,i]),[Je,_]=(0,e.useState)(500),Ke=ve({purchaseAmount:c,purchaseType:$},Je),{purchaseAmount:S,purchaseType:se}=Ke,M=(0,e.useCallback)(t=>{let o=parseFloat(t),y=m?T?.toUpperCase():n,Q=m?Number(A(B)):k(B,i??0,R),F=m?Number(A(U)):k(U,i??0,R),rt=o<Q,nt=o>F,ge=rt?r("buyAssetScreenMinPurchasePriceInterpolated",{amount:`${Q} ${y}`}):nt?r("buyAssetScreenMaxPurchasePriceInterpolated",{amount:`${F} ${y}`}):void 0;return ge==null?{status:"pass"}:{status:"fail",message:ge}},[A,m,r,T,n,B,i,U]),Ze=(0,e.useCallback)(({value:t})=>M(t),[M]),ae=(0,e.useCallback)(t=>{let o=M(t);_(500),l({...d,purchaseAmount:t,checkoutQuoteType:"recommended"}),x(o?o.message:void 0)},[d,l,M]),Ye=(0,e.useCallback)(t=>{O.capture("fiatOnrampAmountSelected",{data:{networkId:h,chainId:Z.getChainID(h),asset:{name:j,symbol:n,type:"fungible"},amount:t}}),_(100),l({...d,purchaseAmount:t,purchaseType:"currency",checkoutQuoteType:"recommended"}),x(void 0)},[d,n,j,h,l,O]),Re=(0,e.useCallback)(t=>{if(t.preventDefault(),!i)return;let o=m?k(w(p),i,ne):A(Y(p,i));_(100),l({...d,purchaseAmount:o.toString(),purchaseType:m?"token":"currency"}),x(void 0)},[d,ne,A,p,l,m,w,i]),{data:[de]}=Fe(["enable-fiat-ramp-optimize-defaults"]),H=(0,e.useMemo)(()=>({...se==="currency"?{fiatAmount:S}:{tokenAmount:S},token:C,fiatCurrencyCode:T,destinationAddress:{address:z,chainId:C?.chainId,resourceType:"address"},optimizeDefaults:de}),[C,S,se,T,z,de]),W=_e==="selected",X=!W&&I&&!!S,{data:G,isLoading:me,isError:ue}=De("web-embedded",J,K.language,{...H,paymentMethodId:q?.id,providerId:V?.id},X),u=W?q:G?.paymentMethod,b=W?V:G?.provider,ce=(0,e.useCallback)(()=>{l({...d,paymentMethod:u}),oe.toStack("fiat-ramp-detail")},[oe,d,u,l]),le=(0,e.useMemo)(()=>X&&me?{id:"recommended-quote-loading",topLeft:r("buyThirdPartyScreenLoadingQuote"),end:e.default.createElement(te,{diameter:20}),disabled:!0}:!I||!u||!b||ue?{type:"drawer",id:"no-quote",topLeft:()=>e.default.createElement(e.default.Fragment,null,e.default.createElement(ee.CreditCard,{size:18}),e.default.createElement(g,{font:"caption"},r("buyThirdPartyScreenChoseQuote"))),disabled:!0,onClick:()=>null}:{type:"drawer",id:"selected-quote",onClick:ce,topLeft:{text:u?.name,before:u?.assets?.icon?e.default.createElement("img",{src:u?.assets?.icon,width:24,height:24}):void 0},topRight:{text:b?.name}},[ce,I,X,ue,me,u,b,r]),[et,pe]=(0,e.useState)(!1),fe=I&&(!!G||!!q&&!!V),tt=(0,e.useMemo)(()=>({...H,paymentMethodId:u?.id||"",providerId:b?.id||"",redirectURL:re}),[H,u?.id,b?.id,re]),ot=ke(),ye=async t=>{if(fe){t&&t.preventDefault(),O.capture("fiatOnrampBuyClickedByUser",{data:{networkId:h,chainId:Z.getChainID(h),asset:{name:j,symbol:n,type:"fungible"},purchaseType:$,amount:S,paymentMethod:u?.id,provider:b?.id}}),l({...d,price:i??0}),pe(!0);try{let{url:o,sessionId:y}=await Be("web-embedded",J,K.language,tt,ot);v?v(o,y,Ae(C),b):self.open(o,"_blank")?.focus()}catch(o){Ce.captureError(o,"onRamp")}pe(!1)}};return e.default.createElement(s,{justifyContent:"space-between",height:"100%"},e.default.createElement(s,null,e.default.createElement(s,{alignItems:"center",gap:32},e.default.createElement(g,{font:"heading3"},r("buyAssetInterpolated",{tokenSymbol:n})),e.default.createElement($e,{image:{type:"fungible",src:He,fallback:n??""},size:96})),e.default.createElement(s,{direction:"row",gap:8,alignItems:"center",justifyContent:"flex-start",marginTop:24,padding:16,borderRadius:16,backgroundColor:"bgArea"},e.default.createElement(g,{font:"body"},We),e.default.createElement(g,{font:"caption",color:"textSecondary"},"(",Se(z,4),")")),e.default.createElement("form",{onSubmit:void 0,className:E({marginTop:8})},e.default.createElement(Ee,{value:c,onChangeText:ae,placeholder:r("amount"),id:"purchaseAmount",label:r("amount"),end:m?T:n,showLabel:!1,validator:Ze,setValue:ae}),e.default.createElement(s,{justifyContent:"space-between",direction:"row",alignItems:"center",marginTop:8},e.default.createElement(s,null,e.default.createElement(s,{onPress:Re,gap:4},i?e.default.createElement(g,{color:"textSecondary",font:"caption"},Ge,i===0?null:e.default.createElement(ee.Swap2Vertical,{size:12,className:E({marginLeft:4})})):e.default.createElement(g,null,`??? ${n}`))),e.default.createElement(s,{direction:"row",gap:8},je.map(t=>e.default.createElement(N,{size:"micro",key:t,theme:c===t?"primary":"secondary",onClick:()=>Ye(t)},Xe,e.default.createElement(g,{font:"label"},t))))))),e.default.createElement(s,null,le&&e.default.createElement(Ne,{rows:[le]}),e.default.createElement(s,{gap:8,marginTop:12,direction:"row",justifyContent:"space-between",className:qe},e.default.createElement(N,{theme:"secondary",onClick:f},r("commandCancel")),e.default.createElement(N,{theme:"primary",disabled:!fe||et,onClick:ye},r("commandBuy")))))};export{Bt as a};
//# sourceMappingURL=chunk-6HZ5LT25.js.map
